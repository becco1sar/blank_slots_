#!/bin/bash
#Command  to run after package install

#Create folders /file (log file, tmp folders for screenshot) and set permissions
echo 'creating blank_slots_screenshots folder under /tmp to contain the screenshots'
mkdir /tmp/blank_slots_screenshots # destination for screenshot are removed after reboot
echo 'changin owner of /tmp/blank_slots_screenshots to ccplayer'
chown ubuntu:ubuntu /tmp/blank_slots_screenshots
echo 'Set permission to  rwx r-x r-x for folder /tmp/blank_slots'
chown 755 /tmp/blank_slots_screenshots
echo 'create the tool final location'
mkdir -p /opt/scripts/blank_slots
echo 'Set permission to  rwx r-x r-x for folder /opt/script/blank_slots'
chown 755 /opt/scripts/blank_slots

#create the log file and change owner.
echo 'Creating log file /var/log/blank_slot.log'
touch /var/log/blank_slot.log #will hold events about the screenshots when a blank slot was  detected,  if it raised an alarm or cleared 
echo 'Changing owner for log file /var/log/blank_slot.log'
chown ubuntu:ubuntu /var/log/blank_slot.log
echo 'Set permission to  --- r-x r-x for file /var/log/blank_slot.log'
chown 644 /var/log/blank_slot.log

#copy tool to the appropriate folder
echo 'Copy blankslotdetector to /opt/scripts/blank_slots'
#allow the blank_slot.py to run
echo 'Making the script executable -> /opt/scripts/blank_slots/blank_slot.py'
chmod +x /opt/scripts/blank_slots/blank_slot.py

#copy service to correct target location /etc/systemd/system
echo 'Copying the script to /etc/systemd/system location'
cp /tmp/blank_slots/etc/systemd/blank_slot.service /etc/systemd/system/blank_slot.service
# #dependencies will be install using apt or pip if allowed using the requirements.txt (pip not installed by default in our environment)
# echo 'Installing pillow library for Python'
# apt install python3-pil

#enable start service
echo 'restarting systemd'
systemctl daemon-reload
echo 'enabling blank_slot.service'
systemctl enable blank_slot.service
echo 'starting blank_slot.service'
systemctl start blank_slot.service
